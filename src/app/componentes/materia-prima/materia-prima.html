<div class="materia-prima-container" [style.--color-sistema]="colorSistema">
    <!-- Header -->
    <div class="header-section text-center mb-4">
        <h1 class="title fw-bold" [style.color]="colorSistema">
            {{ modo() === 'normal' ? 'LISTADO MATERIA PRIMA' : modo() === 'ajustar' ? 'AJUSTAR MATERIA PRIMA' :
            'ABASTECER MATERIA PRIMA' }}
        </h1>
        <div class="title-underline mx-auto" [style.background-color]="colorSistema"></div>

        @if (modo() === 'normal') {
        <button class="btn btn-crear shadow-sm position-absolute end-0 top-0 me-4 mt-3"
            [style.background-color]="colorSistema" (click)="crearInsumo()">
            <i class="bi bi-box-seam-fill me-2"></i> Crear producto
        </button>
        } @else {
        <div class="position-absolute start-0 top-0 ms-4 mt-3 d-flex gap-2">
            <button class="btn btn-dark shadow-sm px-4" (click)="regresarNormal()">
                <i class="bi bi-chevron-left me-2"></i> Regresar
            </button>
        </div>
        <div class="position-absolute end-0 top-0 me-4 mt-3">
            <button class="btn btn-save shadow-sm px-4" [style.background-color]="colorSistema"
                (click)="guardarCambios()">
                <i class="bi bi-save-fill me-2"></i> Guardar
            </button>
        </div>
        }
    </div>

    <!-- Filtros y Buscador -->
    <div class="row mb-3 align-items-center">
        <div class="col-md-5">
            <div class="d-flex align-items-center gap-2 barcode-container p-1 shadow-sm rounded-3">
                <label class="fw-bold text-nowrap ms-2 h5 m-0">Código de producto</label>
                <div class="barcode-input-wrapper position-relative flex-grow-1">
                    <i class="bi bi-upc-scan position-absolute start-0 top-50 translate-middle-y ms-2 text-muted"></i>
                    <input type="text" class="form-control border-0 ps-5" placeholder="Escaneo..."
                        [ngModel]="codigoBarrasBusqueda()" (input)="alCambiarBarras($event)">
                </div>
            </div>
        </div>
        <div class="col-md-7 d-flex justify-content-end">
            <div class="search-box position-relative shadow-sm rounded-3 overflow-hidden" style="width: 350px;">
                <input type="text" class="form-control border-0 ps-3 pe-5" placeholder="Buscar..."
                    [ngModel]="textoBusqueda()" (input)="alCambiarBusqueda($event)">
                <i class="bi bi-search position-absolute end-0 top-50 translate-middle-y me-3 text-muted"></i>
            </div>
        </div>
    </div>

    <!-- Tabla -->
    <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
        <div class="table-container p-0">
            <table class="table table-hover align-middle m-0">
                <thead class="sticky-top bg-white shadow-sm">
                    <tr>
                        <th class="py-3 text-muted small">No. <i class="bi bi-arrow-down-up ms-1"></i></th>
                        <th class="py-3 text-muted small">Categoría <i class="bi bi-arrow-down-up ms-1"></i></th>
                        <th class="py-3 text-muted small">Producto <i class="bi bi-arrow-down-up ms-1"></i></th>
                        <th class="py-3 text-muted small">Unidad <i class="bi bi-arrow-down-up ms-1"></i></th>

                        <th class="py-3 text-muted small">Stock <i class="bi bi-arrow-down-up ms-1"></i></th>

                        @if (modo() === 'abastecer') {
                        <th class="py-3 text-muted small text-center bg-light">Abastecer</th>
                        }

                        <th class="py-3 text-muted small">Estatus <i class="bi bi-arrow-down-up ms-1"></i></th>
                        <th class="py-3 text-muted small text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @if (cargando()) {
                    <tr>
                        <td colspan="8" class="text-center py-5">
                            <div class="spinner-border" [style.color]="colorSistema" role="status"></div>
                        </td>
                    </tr>
                    } @else {
                    @for (p of insumosPaginados(); track p.CodigoProducto; let i = $index) {
                    <tr>
                        <td class="small text-muted fw-bold">{{ (paginaActual() - 1) * itemsPorPagina + i + 1 |
                            number:'2.0' }}</td>
                        <td class="small">{{ p.NombreCategoria }}</td>
                        <td class="small fw-bold">{{ p.NombreProducto }}</td>
                        <td class="small">{{ p.NombreUnidad }}</td>

                        <td class="small">
                            @if (modo() === 'ajustar') {
                            <input type="number" class="form-control form-control-sm text-center fw-bold border-success"
                                style="width: 80px; margin: 0 auto;" [value]="p.Stock"
                                (input)="onCambioAjuste(p.CodigoProducto!, $any($event.target).value)">
                            } @else {
                            <span class="fw-bold" [class.text-danger]="p.Stock === 0">{{ p.Stock || '-' }}</span>
                            }
                        </td>

                        @if (modo() === 'abastecer') {
                        <td class="bg-light">
                            <input type="number" class="form-control form-control-sm text-center fw-bold border-primary"
                                style="width: 80px; margin: 0 auto;" placeholder="+"
                                (input)="onCambioAbastecer(p.CodigoProducto!, $any($event.target).value)">
                        </td>
                        }

                        <td class="small">
                            <span class="badge rounded-pill px-3" [style.color]="p.Estatus === 1 ? 'green' : 'red'"
                                [style.backgroundColor]="p.Estatus === 1 ? 'rgba(0,128,0,0.1)' : 'rgba(255,0,0,0.1)'">
                                {{ p.Estatus === 1 ? 'Activo' : 'Inactivo' }}
                            </span>
                        </td>
                        <td class="text-center">
                            <button class="btn btn-link p-1 text-dark" (click)="editarInsumo(p)">
                                <i class="bi bi-pencil-square fs-4"></i>
                            </button>
                            <button class="btn btn-link p-1 text-danger" (click)="eliminarInsumo(p.CodigoProducto)">
                                <i class="bi bi-trash-fill fs-4"></i>
                            </button>
                        </td>
                    </tr>
                    }
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Footer Paginacion -->
    <div class="row mt-4 align-items-center">
        <div class="col-md-3">
            <span class="text-muted small">Mostrando {{ rangoInicio() }} al {{ rangoFin() }} de {{ totalRegistros() }}
                registros</span>
        </div>
        <div class="col-md-6 text-center">
            @if (modo() === 'normal') {
            <div class="d-flex justify-content-center gap-3">
                <button class="btn btn-adjust text-white px-4 fw-bold shadow-sm" [style.background-color]="colorSistema"
                    (click)="activarAjuste()">
                    <i class="bi bi-gear-fill me-2"></i> Ajustar
                </button>
                <button class="btn btn-supply text-white px-4 fw-bold shadow-sm" [style.background-color]="colorSistema"
                    (click)="activarAbastecer()">
                    <i class="bi bi-box-arrow-in-down me-2"></i> Abastecer
                </button>
            </div>
            }
        </div>
        <div class="col-md-3 d-flex justify-content-end">
            <nav>
                <ul class="pagination pagination-sm m-0">
                    <li class="page-item" [class.disabled]="paginaActual() === 1">
                        <button class="page-link" (click)="paginaAnterior()"><i class="bi bi-chevron-left"></i></button>
                    </li>
                    @for (p of paginas(); track $index; let i = $index) {
                    <li class="page-item" [class.active]="paginaActual() === p">
                        <button class="page-link" (click)="irAPagina(p)"
                            [style.background-color]="paginaActual() === p ? colorSistema : ''"
                            [style.border-color]="paginaActual() === p ? colorSistema : ''">
                            {{ p }}
                        </button>
                    </li>
                    }
                    <li class="page-item" [class.disabled]="paginaActual() === totalPaginas()">
                        <button class="page-link" (click)="paginaSiguiente()"><i
                                class="bi bi-chevron-right"></i></button>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>